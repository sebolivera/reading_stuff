{% extends 'base.html' %} {% block content %}
{% load static %}
<div class="container shadow-lg">
  <div class="row">
{% if request.COOKIES.site_color_mode and request.COOKIES.site_color_mode == "dark" %}
    <div class="col-md-8 card mb-4  mt-3 left top text-light bg-dark shadow-lg">
{% else %}
    <div class="col-md-8 card mb-4  mt-3 left top text-dark bg-light shadow-lg">
{% endif %}
      <div class="card-body">
        <h1>{% block title %} {{ post.title }} {% endblock title %}</h1>
        <p class=" text-muted">{{ post.author }} {{ post.created_on }}</p>
        <p class="card-text ">{{ post.content | safe }}</p>
      </div>
    </div>
    {% block sidebar %} {% include 'sidebar_nosearch.html' %} {% endblock sidebar %}
  </div>

<div class="row mt-3">
{% if request.COOKIES.site_color_mode and request.COOKIES.site_color_mode == "dark" %}
<div class="card mb-4 mt-3 left top text-light bg-dark shadow-lg">
{% else %}
<div class="card mb-4 mt-3 left top text-dark bg-light shadow-lg">
{% endif %}
    {% if user.is_authenticated and user_inactive_comments and not moderation_comments %}
        <h4>The following comment{{user_inactive_comments|pluralize}} {{user_inactive_comments|pluralize:"is,are"}} awaiting a review:</h4>
        <div class="container bg-teal shadow-lg">
            {% for comment in user_inactive_comments %}
                {% if request.COOKIES.site_color_mode and request.COOKIES.site_color_mode == "dark" %}
                    <div class="row card mt-2 bg-dark text-light shadow-lg">
                {% else %}
                    <div class="row card mt-2 bg-light text-dark shadow-lg">
                {% endif %}
                    <div class="comments shadow-lg" style="padding: 10px;">
                        <p class="font-weight-normal text-primary">
                            {{ comment.user }} 
                        <span class="text-dark">on</span>
                        <span class="font-weight-light fs-6 text-muted">
                            {{ comment.created_on }}
                        </span>
                        </p>
                        <p class="font-weight-normal text-info">
                            {{ comment.body | safe }}
                        </p>
                    </div>
                </div>
            {% endfor %}
        </div>
        <hr/>
    {% endif %}
    {% if perms.readwrite.moderate or moderator_ajax_allowed %}
        <script type="text/javascript">
            var url_approve="{% url 'approve_comment' %}";
            var url_delete="{% url 'delete_comment' %}";
        </script>
    {% endif %}

    {% if user.is_authenticated and moderation_comments %}
        <h4>The following comment{{moderation_comments|pluralize}} {{moderation_comments|pluralize:"is,are"}} awaiting  {{moderation_comments|pluralize:"its,their"}} review{{moderation_comments|pluralize}}:</h4>
        <div class="container bg-teal shadow-lg">
            {% for comment in moderation_comments %}
                {% if request.COOKIES.site_color_mode and request.COOKIES.site_color_mode == "dark" %}
                    <div class="row card mt-2 bg-dark text-light shadow-lg">
                {% else %}
                    <div class="row card mt-2 bg-light text-dark shadow-lg">
                {% endif %}
                    <div class="comments shadow-lg" style="padding: 10px;">
                        <p class="font-weight-normal text-primary">
                            {{ comment.user }} 
                        <span class="text-dark">on</span>
                        <span class="font-weight-light fs-6 text-muted">
                            {{ comment.created_on }}
                        </span>
                        </p>
                        <p class="font-weight-normal text-info">
                            {{ comment.body | safe}}
                        </p>
                        <form class="form-moderation approve" action="javascript:void(0);" method="POST"  id="{{comment.id}}">
                            <button type="submit" class="btn btn-success approve-comment">Approve</button>
                        </form>
                        <form class="form-moderation delete" action="javascript:void(0);" method="POST"  id="{{comment.id}}">
                            <button type="submit" class="btn btn-danger delete-comment" >Delete</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>
        <hr/>
    {% endif %}
    <span class="main-comments">
    {% include 'ajax/comments.html' %}
    {% block main_content %}
    {% endblock main_content %}
    </span>
    <hr/>
    {% if user.is_authenticated %}
        <h3>Leave a comment</h3>
        <form method="post" style="margin-top: 1.3em;" id="submit_comment" action="">
            {% for field in comment_form.visible_fields %}
                {{ field }}
            {% endfor %}
            {% csrf_token %}
            <br/>
            <span id="comment_submit_button" name="comm_anchor">
                <button type="submit" class="btn btn-primary btn-lg">Submit</button>
            </span>
        </form>
        <script type="text/javascript">var wipe=false;</script>
        {% for message in messages %}
            {% if message.tags == "success" %}
            <script type="text/javascript">var wipe=true;</script>
            {% endif %}
        {% endfor %}
        <script type="text/javascript" src="{% static 'js/comments.js' %}"></script>
    {% else %}
        <h3>You need to be <a class="font-weight-bold" href="{% url 'login' %}">logged in</a> order to leave a comment!</h3>
    {% endif %}
</div>
</div>
{% endblock content %}